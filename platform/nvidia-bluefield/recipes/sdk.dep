#
# Copyright (c) 2024 NVIDIA CORPORATION & AFFILIATES.
# Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

SDK_COMMON_FLAGS_LIST = $(SONIC_COMMON_FLAGS_LIST) $(SDK_VERSION)
SDK_COMMON_FILES_LIST = $(SONIC_COMMON_BASE_FILES_LIST) \
	$(SONIC_COMMON_FILES_LIST) \
	$(PLATFORM_PATH)/recipes/sdk.mk \
	$(PLATFORM_PATH)/recipes/sdk.dep \
	$(PLATFORM_PATH)/recipes/get_sdk_package_version.sh

# OFED

SPATH := $($(OFED_KERNEL)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(OFED_KERNEL)_CACHE_MODE := GIT_CONTENT_SHA
$(OFED_KERNEL)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(OFED_KERNEL)_DEP_FILES := $(DEP_FILES)

$(MLNX_TOOLS)_CACHE_MODE := GIT_CONTENT_SHA
$(MLNX_TOOLS)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(MLNX_TOOLS)_DEP_FILES := $(DEP_FILES)

$(OFED_KERNEL_UTILS)_CACHE_MODE := GIT_CONTENT_SHA
$(OFED_KERNEL_UTILS)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(OFED_KERNEL_UTILS)_DEP_FILES := $(DEP_FILES)

# mlnx-iproute2

SPATH := $($(MLNX_IPROUTE2)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(MLNX_IPROUTE2)_CACHE_MODE := GIT_CONTENT_SHA
$(MLNX_IPROUTE2)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(MLNX_IPROUTE2)_DEP_FILES := $(DEP_FILES)

# RDMA core and derived packages

SPATH := $($(RDMA_CORE)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(RDMA_CORE)_CACHE_MODE := GIT_CONTENT_SHA
$(RDMA_CORE)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(RDMA_CORE)_DEP_FILES := $(DEP_FILES)

$(IB_VERBS_PROV)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_VERBS_PROV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_VERBS_PROV)_DEP_FILES := $(DEP_FILES)

$(IB_VERBS)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_VERBS)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_VERBS)_DEP_FILES := $(DEP_FILES)

$(IB_VERBS_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_VERBS_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_VERBS_DEV)_DEP_FILES := $(DEP_FILES)

$(IB_UMAD)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_UMAD)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_UMAD)_DEP_FILES := $(DEP_FILES)

$(IB_UMAD_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_UMAD_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_UMAD_DEV)_DEP_FILES := $(DEP_FILES)

ifeq ($(SDK_FROM_SRC),y)
$(RDMA_CORE_DBGSYM)_CACHE_MODE := GIT_CONTENT_SHA
$(RDMA_CORE_DBGSYM)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(RDMA_CORE_DBGSYM)_DEP_FILES := $(DEP_FILES)

$(IB_VERBS_PROV_DBGSYM)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_VERBS_PROV_DBGSYM)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_VERBS_PROV_DBGSYM)_DEP_FILES := $(DEP_FILES)

$(IB_VERBS_DBGSYM)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_VERBS_DBGSYM)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_VERBS_DBGSYM)_DEP_FILES := $(DEP_FILES)

$(IB_UMAD_DBGSYM)_CACHE_MODE := GIT_CONTENT_SHA
$(IB_UMAD_DBGSYM)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(IB_UMAD_DBGSYM)_DEP_FILES := $(DEP_FILES)
endif

# DPDK packages

SPATH := $($(DPDK)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(DPDK)_CACHE_MODE := GIT_CONTENT_SHA
$(DPDK)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(DPDK)_DEP_FILES := $(DEP_FILES)

$(DPDK_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(DPDK_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(DPDK_DEV)_DEP_FILES := $(DEP_FILES)


# RXP compiler

SPATH := $($(RXPCOMPILER)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(RXPCOMPILER)_CACHE_MODE := GIT_CONTENT_SHA
$(RXPCOMPILER)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(RXPCOMPILER)_DEP_FILES := $(DEP_FILES)

$(LIBRXPCOMPILER_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(LIBRXPCOMPILER_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(LIBRXPCOMPILER_DEV)_DEP_FILES := $(DEP_FILES)


# GRPC

SPATH := $($(LIBGRPC_DEV)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(LIBGRPC_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(LIBGRPC_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(LIBGRPC_DEV)_DEP_FILES := $(DEP_FILES)

$(LIBGRPC_DBG)_CACHE_MODE := GIT_CONTENT_SHA
$(LIBGRPC_DBG)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(LIBGRPC_DBG)_DEP_FILES := $(DEP_FILES)

# DOCA

SPATH := $($(DOCA_LIBS)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(DOCA_LIBS)_CACHE_MODE := GIT_CONTENT_SHA
$(DOCA_LIBS)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(DOCA_LIBS)_DEP_FILES := $(DEP_FILES)

$(DOCA_LIBS_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(DOCA_LIBS_DEV)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(DOCA_LIBS_DEV)_DEP_FILES := $(DEP_FILES)

ifeq ($(SDK_FROM_SRC),y)
$(DOCA_LIBS_DBG)_CACHE_MODE := GIT_CONTENT_SHA
$(DOCA_LIBS_DBG)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(DOCA_LIBS_DBG)_DEP_FILES := $(DEP_FILES)
endif

# SDN appliance

SPATH := $($(SDN_APPL)_SRC_PATH)
DEP_FILES := $(SDK_COMMON_FILES_LIST)
DEP_FILES += $(shell git ls-files -- $(SPATH))

$(SDN_APPL)_CACHE_MODE := GIT_CONTENT_SHA
$(SDN_APPL)_DEP_FLAGS := $(SDK_COMMON_FLAGS_LIST)
$(SDN_APPL)_DEP_FILES := $(DEP_FILES)
